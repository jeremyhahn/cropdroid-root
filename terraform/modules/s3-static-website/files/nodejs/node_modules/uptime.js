const synthetics = require('Synthetics');
const log = require('SyntheticsLogger');

const url     = process.env.URL;
const timeout = process.env.TIMEOUT;

const up = async () => {
    log.info('Starting canary');
    const page = await synthetics.getPage();
    const response = await page.goto(url, {waitUntil: 'domcontentloaded', timeout: timeout});
    try {
        if (!response) {
            throw 'Failed to load url ' + url + ', the website might be down.'
        }
    } finally {
        await synthetics.takeScreenshot('loaded', 'result');
    }
}

exports.handler = async () => {
    return await up();
}
